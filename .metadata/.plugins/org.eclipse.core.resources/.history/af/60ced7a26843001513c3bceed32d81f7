/**
 * Arduino - External eeprom
 * 
 * ExternalEeprom.h
 * 
 * This is an abstract class of external eeprom.
 * 
 * @author Dalmir da Silva <dalmirdasilva@gmail.com>
 */

#ifndef __ARDUINO_EXTERNAL_EEPROM_H__
#define __ARDUINO_EXTERNAL_EEPROM_H__ 1

class ExternalEeprom {

    /**
     * The size of the device.
     */
    uint16_t deviceSize;

    /**
     * The size of the device page.
     */
    int16_t pageSize;

    /**
     * Device address number.
     */
    uint8_t device;
public:

    /**
     * Writes a uint8_t at the address into the device.
     * 
     * @param address   The address where the data will be written.
     * @param b         The data to be written.
     */
    virtual void write(uint16_t address, uint8_t b);

    /**
     * Writes a buffer of bytes at the address into the device.
     * 
     * @param address
     * @param buffer
     * @param len
     */
    virtual void writeBytes(uint16_t address, uint8_t* buf, int16_t len);

    /**
     * Reads a uint8_t from the device.
     * 
     * @param address
     * @return 
     */
    virtual int16_t read(uint16_t address);

    /**
     * Reads a buffer with len bytes from the device.
     * 
     * @param address
     * @param buf
     * @param len
     */
    virtual int16_t readBytes(uint16_t address, uint8_t* buf, int16_t len);

    /**
     * Writes len bytes at the address with data.
     * 
     * @param address
     * @param data
     * @param len
     */
    virtual int16_t setBytes(uint16_t address, uint8_t b, int16_t len);

    /**
     * Gets the device number.
     * 
     * @return 
     */
    uint8_t getDevice() {
        return device;
    }

    /**
     * Gets the page size of the device.
     * 
     * @return 
     */
    int16_t getPageSize() {
        return pageSize;
    }

    /**
     * Gets the total size of the device.
     * 
     * @return 
     */
    uint16_t getDeviceSize() {
        return deviceSize;
    }

    /**
     * Writes a block of bytes separately by pages to the device.
     * All bytes during a page write operation must reside on the same page.
     * 
     * @param address
     * @param buf
     * @param len
     */
    virtual void writeBlock(uint16_t address, uint8_t* buf, int16_t len) = 0;

    /**
     * Reads a block of bytes from the device.
     * 
     * @param address
     * @param buffer
     * @param len
     */
    virtual void readBlock(uint16_t address, uint8_t* buf, int16_t len) = 0;

protected:

    /**
     * Protected constructor.
     * 
     * @param device
     */
    ExternalEeprom(int16_t pageSize, uint16_t deviceSize, uint8_t device);

    /**
     * Determines the length until first multiple of 'pageSize' of an address
     * so writing always occurs up to 'pageSize' uint8_t boundaries.
     * 
     * @param address
     * @return 
     */
    uint16_t endOfPage(uint16_t address);
};

#endif /* __ARDUINO_EXTERNAL_EEPROM_H__ */
